# mindNote MCP 工具部署和运行指南

## 概述

本指南介绍如何部署和运行mindNote项目的MCP工具。这些工具包括：
- 日记记录MCP (`diary-record-mcp`) - 端口 3000
- 环境监测MCP (`emotion-monitor-mcp`) - 端口 3001
- 洞察生成MCP (`insight-generator-mcp`) - 端口 3002

## 系统要求

- Node.js (版本 14.x 或更高)
- npm (随Node.js一起安装)

## 部署步骤

### 1. 克隆或下载项目

```bash
# 如果使用git
git clone <repository-url>
cd mindNote/mcp-tools
```

### 2. 为每个MCP工具安装依赖

#### 日记记录MCP
```bash
cd diary-record-mcp
npm install
```

#### 环境监测MCP
```bash
cd ../emotion-monitor-mcp
npm install
```

#### 洞察生成MCP
```bash
cd ../insight-generator-mcp
npm install
```

### 3. 启动MCP工具

每个工具需要在独立的终端窗口或进程中运行：

#### 启动日记记录MCP (端口 3000)
```bash
cd diary-record-mcp
npm start
```

#### 启动环境监测MCP (端口 3001)
```bash
cd emotion-monitor-mcp
npm start
```

#### 启动洞察生成MCP (端口 3002)
```bash
cd insight-generator-mcp
npm start
```

## 验证部署

启动所有工具后，可以通过以下URL验证它们是否正常运行：

- 日记记录MCP: http://localhost:3000
- 环境监测MCP: http://localhost:3001
- 洞察生成MCP: http://localhost:3002

## API测试示例

### 测试日记记录功能
```bash
curl -X POST http://localhost:3000/record_emotion_diary \
  -H "Content-Type: application/json" \
  -d '{
    "mood_score": 8,
    "mood_tags": ["happy", "relaxed"],
    "environment_data": {
      "temperature": 24.5,
      "humidity": 50,
      "light_level": 400,
      "weather": "sunny"
    },
    "note": "Enjoying a beautiful day"
  }'
```

### 测试环境监测功能
```bash
curl http://localhost:3001/get_current_environment
```

### 测试洞察生成功能
```bash
curl "http://localhost:3002/get_emotion_insights"
```

## 配置选项

### 环境变量

可以在每个工具目录中创建 `.env` 文件来配置环境变量：

```bash
# diary-record-mcp/.env
PORT=3000
NODE_ENV=production

# emotion-monitor-mcp/.env
PORT=3001
NODE_ENV=production

# insight-generator-mcp/.env
PORT=3002
NODE_ENV=production
```

## 故障排除

### 端口冲突
如果端口3000、3001或3002已被占用，请修改相应工具目录下的启动配置或使用环境变量指定其他端口。

### 依赖问题
如果遇到依赖问题，请尝试：
```bash
npm ci  # 清理并重新安装依赖
```

### 权限问题
确保对项目目录有适当的读写权限，特别是 `data/` 目录用于存储日记条目。

## 生产部署建议

1. 使用进程管理器如 PM2 来管理工具进程
2. 配置反向代理（如Nginx）来处理请求
3. 设置适当的日志记录和监控
4. 使用环境变量管理配置
5. 定期备份数据文件

## 停止服务

要停止服务，可以在每个工具的终端窗口中按 `Ctrl+C`，或使用以下命令：

```bash
# 停止所有node进程（谨慎使用）
pkill -f "node index.js"
```